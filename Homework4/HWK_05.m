clear all
clc
t=[0,1,2,3,4,5];
q1=[0,0.3927,0.7854,1.0210,1.1781,1.5708];
q11=[0,0.1963,0.2749,0.3142,0.1963,0];
q2=[0,0.3236,0.6155,0.8472,0.9959,1.0472];
q22=[0,0.3466,0.2948,0.2142,0.1126,0];
q3=[0,0.1047,0.2094,0.3142,0.4189,0.5236];
q33=[0,0.3466,0.2948,0.2142,0.1126,0];

for i=1:5
   A=[1,t(i),t(i)^2,t(i)^3;1,t(i+1),t(i+1)^2,t(i+1)^3;0,1,2*t(i),3*t(i)^2;0,1,2*t(i+1),3*t(i+1)^2];
   b1=[q1(i);q1(i+1);q11(i);q11(i+1)];
   b2=[q2(i);q2(i+1);q22(i);q22(i+1)];
   b3=[q3(i);q3(i+1);q33(i);q33(i+1)];
   X1=inv(A)*b1;
   X2=inv(A)*b2;
   X3=inv(A)*b3;
   ydd1(i)=6*X1(4)*t(i)+2*X1(3);%第一个关节加速度拟合曲线
   ydd2(i)=6*X2(4)*t(i)+2*X2(3);%第二个关节加速度拟合曲线
   ydd3(i)=6*X3(4)*t(i)+2*X3(3);%第三个关节加速度拟合曲线
end
%定义初始以及结尾加速度为0
ydd1(1)=0;
ydd2(1)=0;
ydd3(1)=0;
ydd1(6)=0;
ydd2(6)=0;
ydd3(6)=0;
%定义seriallink
a1=4;%定义a1的长度为4；
a2=3;%定义a2的长度为3；
a3=2.5;%定义a3的长度为2；
alpha1=0;
alpha2=0;
alpha3=0;
d1=0;
d2=0;
d3=0;
theta1=pi/6;%定义theta1为30°
theta2=pi/3;%定义theta2为60°
theta3=pi/3;%定义theta3为60°
I1=[0,0,0;0,0,0;0,0,0.5];
m1=20;
L(1)=Link('d',d1,'a',a1,'alpha',alpha1,'m',m1,'I',I1);
I2=[0,0,0;0,0,0;0,0,0.2];
m2=15;
L(2)=Link('d',d2,'a',a2,'alpha',alpha2,'m',m2,'I',I2);
I3=[0,0,0;0,0,0;0,0,0.1];
m3=10;
L(3)=Link('d',d3,'a',a3,'alpha',alpha3,'m',m3,'I',I3);
three_link=SerialLink(L,'name','ThreeLink');
q=[q1.',q2.',q3.'];
qd=[q11.',q22.',q33.'];
qdd=[ydd1.',ydd2.',ydd3.'];
Q=three_link.rne(q,qd,qdd);
disp('驱动力矩分别为：');
disp('第一根连杆：')
disp(Q(:,1));
disp('第二根连杆：');
disp(Q(:,2));
disp('第三根连杆：');
disp(Q(:,3));
%第二问
QDD=three_link.accel(q,qd,Q);
error1=QDD(:,1)-ydd1.';
error2=QDD(:,2)-ydd2.';
error3=QDD(:,3)-ydd3.';
disp('加速度误差分别为为：');
disp('第一根连杆');
disp(error1);
disp('第二根连杆');
disp(error2);
disp('第三根连杆');
disp(error3);